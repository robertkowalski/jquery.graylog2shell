/*! jQuery Graylog2 Shell - v0.1.0 - 2012-05-30
* https://github.com/robertkowalski/jquery.graylog2shell
* Copyright (c) 2012 Robert Kowalski; Licensed GPL */
(function(a){var b=function(){var b=this;a.isFunction(b._init)&&b._init.apply(b,arguments)};b.prototype={_init:function(b,c){var d=this,e={};d.defaults=a.fn.shell.defaults,a.extend(!0,e,d.defaults,b),d.options=e,d.$element=a(c),d._createContainerIfNotExists(),d._setWidthOfInput(),d._bindEventsFromKeyboard(),d.focus()},focus:function(){var a=this;a.$element.find("input").focus()},_createContainerIfNotExists:function(){var a=this,b=a._testForContainer();b||a._renderShellHtml()},_testForContainer:function(){var b=this,c=a("#shell-container");if(c&&c.length)return!0},_createShellHtml:function(){var a='<div id="shell-container">                    <ul id="shell">                      <li>                        <span class="shell-prompt">rocko #</span>                        <input class="shell-command-input" type="text" spellcheck="false">                      </li>                    </ul>                  </div>';return a},_renderShellHtml:function(){var a=this,b=a._createShellHtml();a.$element.html(b)},_setWidthOfInput:function(){var b=a("#shell-container"),c=b.find(".shell-prompt"),d=30,e=b.outerWidth(!1)-c.outerWidth(!1)-d;b.find("input").css("width",e)},_bindEventsFromKeyboard:function(){var b=this,c=a("#shell-container"),d=c.find("input"),e,f,g;d.bind("keyup",function(a){e=a.which,e===13?b._handleEnterPress():e===38&&(f=b.lastCommand,g=d.val(),f&&g!==f&&d.val(f))})},_handleEnterPress:function(){var b=this,c=a("#shell-container"),d=c.find("input"),e=d.val();if(!a.trim(e).length)return;if(e==="clear"){b._clearShell();return}b._processInput(e),b.lastCommand=e,d.val("")},_clearShell:function(){var b=a(".shell-prompt").first().html(),c=a(".old-input, .shell-wait");c.remove()},_processInput:function(b){var c=this,d=a("#shell"),e=d.find(".shell-command-input"),f=d.find(".shell-prompt").first(),g=d.find(".old-input"),h='<li class="shell-wait"><div class="shell-loading"></div><div>Calculating</div></li>',i='<li><span class="shell-prompt">'+f.text()+"</span>"+'<span class="old-input">'+e.val()+"</span></li>";d.append(h),!g||!g.length?e.parent().parent().prepend(i):g.last().append(i),e.attr("disabled","disabled"),c._makeAjaxCall(b)},_makeAjaxCall:function(b){a.ajax({type:"POST",url:"analytics/shell",dataType:"json",data:{cmd:b},success:function(a){},error:function(a){}})}},a.fn.extend({shell:function(c){var d=Array.prototype.slice.call(arguments),e=d.shift();return this.each(function(f,g){var h=a.data(g,"shell")||a.data(g,"shell",new b(c,g));e&&typeof e=="string"&&e.charAt(0)!=="_"&&a.isFunction(h[e])&&h[e].apply(h,d)})}}),a.fn.shell.defaults={}})(jQuery);